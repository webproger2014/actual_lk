(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[25],{"464b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"profile"}},[a("div",{staticClass:"row"},[a("q-list",{staticStyle:{width:"100%","max-width":"320px"}},[a("q-item",[a("q-item-section",{attrs:{top:"",side:""}},[a("q-avatar",{staticClass:"cursor-pointer",attrs:{size:"120px"}},[a("q-img",{attrs:{src:t.AVATAR},on:{click:t.prevImgLoad}},[a("div",{staticClass:"fit hover-show radius"},[a("q-btn",{staticClass:"absolute-center",attrs:{round:"",flat:""}},[a("q-icon",{attrs:{name:"photo_camera",size:"32px",color:"white"}})],1)],1)])],1)],1),a("q-item-section",[a("q-item-label",{staticClass:"text-body1",attrs:{lines:"1"}},[t._v(t._s(t._f("phone")(t.$store.state.auth.user.login)))]),t.$store.state.auth.user.name?a("q-item-label",{staticClass:"text-body2",attrs:{caption:""}},[t._v("\n              "+t._s(t.$store.state.auth.user.name)+"\n            ")]):a("q-item-label",{staticClass:"text-body2",attrs:{caption:""}},[t._v("\n              ФИО отсутствует\n            ")]),t.$_.isEmpty(t.$store.state.user.city)?t._e():a("q-item-label",{staticClass:"text-body2",attrs:{caption:""}},[t._v("\n              г. "+t._s(t.$store.state.user.city.label)+"\n            ")])],1)],1)],1),a("div",{staticStyle:{width:"100%","max-width":"700px"}},[a("form",{on:{submit:function(e){return e.preventDefault(),t.updateProfileTh(e)}}},[a("div",{staticClass:"q-pa-md q-gutter-md"},[a("q-input",{ref:"name",attrs:{filled:"",label:"Имя"},model:{value:t.account.name,callback:function(e){t.$set(t.account,"name",e)},expression:"account.name"}}),a("q-input",{attrs:{filled:"",label:"Фамилия"},model:{value:t.account.surname,callback:function(e){t.$set(t.account,"surname",e)},expression:"account.surname"}}),a("q-input",{attrs:{filled:"",label:"Отчество"},model:{value:t.account.lastname,callback:function(e){t.$set(t.account,"lastname",e)},expression:"account.lastname"}}),a("q-input",{attrs:{prefix:"7",mask:"(###) ###-##-##",filled:"",label:"Телефон",name:"phone","unmasked-value":"",hint:"7 (XXX) XXX-XX-XX"},on:{keydown:function(e){t.account.phone=t.fixPhone(t.account.phone)},keyup:function(e){t.account.phone=t.fixPhone(t.account.phone)}},model:{value:t.account.phone,callback:function(e){t.$set(t.account,"phone",e)},expression:"account.phone"}}),a("q-input",{attrs:{filled:"",label:"E-mail"},model:{value:t.account.mail,callback:function(e){t.$set(t.account,"mail",e)},expression:"account.mail"}}),a("q-select",{attrs:{filled:"","use-input":"",options:t.cityes,label:"Ваш город",behavior:"menu"},on:{filter:t.getCity},scopedSlots:t._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[t._v("\n                  Ничего не найдено\n                ")])],1)]},proxy:!0}]),model:{value:t.selectCity,callback:function(e){t.selectCity=e},expression:"selectCity"}}),a("q-btn",{attrs:{color:"light-blue-6",label:"Обновить",type:"submit"}})],1)])])],1),a("q-dialog",{model:{value:t.dialog.upload,callback:function(e){t.$set(t.dialog,"upload",e)},expression:"dialog.upload"}},[a("q-card",{staticClass:"full-width"},[a("q-uploader",{staticClass:"full-width",attrs:{url:"https://api.vevanta.ru/users/upload/"+t.$store.state.auth.user.id,headers:[{name:"token",value:t.$store.state.auth.token}],label:"Custom header",accept:"image/*",filter:t.filterAvatar},on:{uploaded:t.finishUpdateAvatar},scopedSlots:t._u([{key:"header",fn:function(e){return[a("div",{staticClass:"row no-wrap items-center q-pa-sm q-gutter-xs"},[e.uploadedFiles.length>0?a("q-btn",{attrs:{icon:"done_all",round:"",dense:"",flat:""},on:{click:e.removeUploadedFiles}},[a("q-tooltip",[t._v("Удалить изображение")])],1):t._e(),e.isUploading?a("q-spinner",{staticClass:"q-uploader__spinner"}):t._e(),a("div",{staticClass:"col"},[a("div",{staticClass:"q-uploader__title"},[t._v("Выберите изображение (макс 7 МБ) ")]),a("div",{staticClass:"q-uploader__subtitle"},[t._v(t._s(e.uploadSizeLabel)+" / "+t._s(e.uploadProgressLabel))])]),e.canAddFiles?a("q-btn",{attrs:{type:"a",icon:"add_box",round:"",dense:"",flat:""}},[a("q-uploader-add-trigger",{attrs:{id:"prevImgLoad"}}),a("q-tooltip",[t._v("Добавить изображение")])],1):t._e(),e.canUpload?a("q-btn",{attrs:{icon:"cloud_upload",round:"",dense:"",flat:""},on:{click:e.upload}},[a("q-tooltip",[t._v("Загрузить")])],1):t._e(),e.isUploading?a("q-btn",{attrs:{icon:"clear",round:"",dense:"",flat:""},on:{click:e.abort}},[a("q-tooltip",[t._v("Abort Upload")])],1):t._e()],1)]}}])})],1)],1),t.$store.state.auth.user.viber_id?t._e():a("q-footer",[a("q-toolbar",{staticClass:"shadow-1 bg-yellow-1 text-black text-center"},[a("q-btn",{staticStyle:{background:"#9169af",color:"#FFF",margin:"0 auto"},attrs:{unelevated:"",rounded:"",label:"Получать уведомления в Viber"},on:{click:t.onPushViber}})],1)],1)],1)},i=[],o=(a("8e6e"),a("8a81"),a("ac6a"),a("cadf"),a("456d"),a("6b54"),a("06db"),a("7f7f"),a("c47a")),n=a.n(o),r=a("2f62"),c=a("b06b");function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function u(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){n()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var d={name:"profile",data:function(){return{viberPush:!1,dialog:{upload:!1},selectCity:{},cityes:[{value:1,label:"Москва",sublabel:"Москва и Московская обл."},{value:2229,label:"Тюмень",sublabel:"Тюменская обл."},{value:2228,label:"Тобольск",sublabel:"Тюменская обл."},{value:1888,label:"Екатеринбург",sublabel:"Свердловская обл."}],imagesLoad:{triggerSelect:!1},account:{name:"",mail:"",surname:"",lastname:"",phone:""},request:{profileUpdate:1}}},created:function(){this.$_profileWatch(),this.$_getCity(),this.updateProfileTh=this.$_.throttle(this.updateProfile,1e3)},computed:u({},Object(r["b"])({NICKNAME:"user/GET_NICKNAME",AVATAR:"user/GET_AVATAR"})),methods:{prevImgLoad:function(){this.dialog.upload=!0,this.imagesLoad.triggerSelect=!0,this.$nextTick((function(){document.getElementById("prevImgLoad").click()}))},updateProfile:function(){var t=this;if(this.request.profileUpdate){if(!this.$_phoneCheck())return;this.request.profileUpdate=0,this.$store.dispatch("user/UPDATE_DATA_PROFILE",{name:this.account.name||"",lastname:this.account.lastname||"",surname:this.account.surname||"",mail:this.account.mail||"",phone:this.account.phone||"",city_id:this.selectCity.value||this.account.city_id}).then((function(){t.$store.commit("user/SET_CITY",t.selectCity),t.request.profileUpdate=1})).catch((function(){t.request.profileUpdate=1}))}},$_phoneCheck:function(){var t=!0;return 10!==this.account.phone.toString().length&&(t=!1,this.$MSG_ERROR("Некорректный номер телефона")),t},$_profileWatch:function(){var t=this;this.account=u({},this.$store.state.auth.user),this.$watch("$store.state.auth.user",(function(){t.account=u({},t.$store.state.auth.user),t.$_.isEmpty(t.$store.state.user.city)&&t.$store.dispatch("user/GET_CITY_BY_ID"),t.viberPush=t.$store.state.auth.user.viber_id}))},finishUpdateAvatar:function(){this.$store.dispatch("user/UPDATE_AVATAR"),this.dialog.upload=!1},filterAvatar:function(t){var e=this;return t.filter((function(t){var a=t.size<=7e6;return a||e.$MSG_ERROR("Большой размер файла"),a}))},fixPhone:function(t){return"7"===t[0]||"8"===t[0]?parseInt(t.slice(1,t.length))||null:t},$_getCity:function(){var t=this;this.selectCity=u({},this.$store.state.user.city),this.$_.isEmpty(this.$store.state.auth.user)||this.$store.dispatch("user/GET_CITY_BY_ID"),this.$watch("$store.state.user.city",(function(){t.selectCity=u({},t.$store.state.user.city)})),this.$watch("selectCity",(function(e){if(!t.$_.isEmpty(e)){var a=!1;t.cityes.forEach((function(e,s){e.value===t.selectCity.value&&(a=!0)})),a||t.cityes.unshift(t.selectCity)}}))},getCity:function(t,e,a){var s=this;if(t||e(),t){var i=this.$axios.post("city/search",{s:t});i.then((function(t){s.$_.isEmpty(t)?a():(e(),s.cityes=t.data)})).catch((function(t){a()}))}},onPushViber:function(){Object(c["a"])("viber://pa?chatURI=Vevanta72&text=".concat(this.$store.state.auth.user.phone))}}},p=d,h=a("2877"),f=a("eebe"),b=a.n(f),m=a("1c1c"),v=a("66e5"),_=a("4074"),y=a("cb32"),g=a("068f"),q=a("9c40"),$=a("0016"),C=a("0170"),x=a("27f9"),k=a("ddd8"),w=a("24e8"),A=a("f09f"),E=a("ee89"),O=a("05c0"),P=a("0d59"),I=a("cc04"),T=a("7ff0"),Q=a("65c6"),S=Object(h["a"])(p,s,i,!1,null,"50cb0c0e",null);e["default"]=S.exports;b()(S,"components",{QList:m["a"],QItem:v["a"],QItemSection:_["a"],QAvatar:y["a"],QImg:g["a"],QBtn:q["a"],QIcon:$["a"],QItemLabel:C["a"],QInput:x["a"],QSelect:k["a"],QDialog:w["a"],QCard:A["a"],QUploader:E["a"],QTooltip:O["a"],QSpinner:P["a"],QUploaderAddTrigger:I["a"],QFooter:T["a"],QToolbar:Q["a"]})}}]);